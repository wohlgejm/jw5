<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Don't use helper methods in rake tasks</title>
    <meta name="description" content="Personal website of Jerry Wohlgemuth." />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="og:title" content="Don't use helper methods in rake tasks" />
    <meta property="og:type" content="" />
    <meta property="og:url" content="https://jw5.dev" />
    <meta property="og:image" content="" />

    <link rel="apple-touch-icon" href="/img/favicon.ico" />
    <link rel="shortcut icon" type="image/jpg" href="/img/favicon.ico" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@300&display=swap"
      rel="stylesheet"
    />

    <!-- Prism Syntax Highlighting -->
    <link
      href="https://unpkg.com/prismjs@1.20.0/themes/prism.css"
      rel="stylesheet"
    />

    <!-- Tachyons-->
    <link
      rel="stylesheet"
      href="https://unpkg.com/tachyons/css/tachyons.min.css"
    />

    <!-- Local styles-->
    <link rel="stylesheet" href="/styles/main.css" />

    <meta name="theme-color" content="#fafafa" />
  </head>

  <body>
    <div class="mw7 mw7-ns center pa3 ph5-ns">
      <a href="/" class="flex items-center bb no-underline black">
        <img src="/img/waveemoji.svg" alt="Wave" width="50" height="50" />
        <h1 class="ml4">I'm Jerry Wohlgemuth.</h1>
      </a>

      <div class="flex pa3 justify-center">
        <div><a href="/about">about me</a></div>
        <div class="ml4"><a href="mailto:wohlgejm@gmail.com">email</a></div>
        <div class="ml4">
          <a
            href="https://www.linkedin.com/in/wohlgejm"
            rel="noreferrer"
            target="_blank"
            >linkedin</a
          >
        </div>
      </div>
      
<h3 class="tc"> Don't use helper methods in rake tasks</h1>
<h5 class="tc"> 2016-10-27</h1>
<main><p>I recently made the mistake of writing a rake task and, when I had duplicate logic across two of the tasks,
decided to pull it out into a helper method inside the namespace block. I also gave it a general name,
<code>update_foo</code>. This first task ran and worked fine.</p>
<pre class="language-ruby"><code class="language-ruby">namespace <span class="token symbol">:foo</span> <span class="token keyword">do</span><br>  desc <span class="token string">'Updates foo'</span><br>  task <span class="token symbol">:update</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token symbol">:foo</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token symbol">:environment</span><span class="token punctuation">]</span> <span class="token keyword">do</span> <span class="token operator">|</span>_<span class="token punctuation">,</span> args<span class="token operator">|</span><br>    foo <span class="token operator">=</span> <span class="token constant">Foo</span><span class="token punctuation">.</span>find_by_bar<span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token symbol">:foo</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    update_foo<span class="token punctuation">(</span>foo<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><br>  desc <span class="token string">'Updates all foos'</span><br>  task update<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:environment</span><span class="token punctuation">]</span> <span class="token keyword">do</span><br>    <span class="token constant">Foo</span><span class="token punctuation">.</span>all<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token punctuation">{</span> <span class="token operator">|</span>foo<span class="token operator">|</span> update_foo<span class="token punctuation">(</span>foo<span class="token punctuation">)</span> <span class="token punctuation">}</span><br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">update_foo</span></span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><br>    do_something<br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre>
<p>Then, I had another set of tasks that also shared similar logic and had an <code>update_foo</code> helper method.
I ran the second task and was baffled when it didn't work.</p>
<p>After some debugging, it became clear that the helper method of the same name, <em>in the other rake task</em> was
being called. <code>update_foo</code> was being defined globally and was overwritten by definition inside the other rake task.
Instead of doing this, I should've extracted this common logic into its own class.</p>
</main>

<script src="https://utteranc.es/client.js"
        repo="wohlgejm/jw5"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

    </div>
  </body>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script
    async
    src="https://www.googletagmanager.com/gtag/js?id=G-CY25JVKR0D"
  ></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-CY25JVKR0D");
  </script>
</html>
